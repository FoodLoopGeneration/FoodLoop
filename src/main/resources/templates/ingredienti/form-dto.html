<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head(${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'})}">
</head>

<body>
    <header th:replace="~{fragments/layout :: navbar}"></header>

    <div class="container">
        <h1 th:text="${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'}"></h1>

        <form th:object="${ingredienteDTO}"
            th:action="@{/ingredienti}" method="post" th:if="${mode == 'create'}">

            <div th:if="${#fields.hasErrors('*')}" class="alert alert-error">
                <strong>Attenzione:</strong> Controlla i campi evidenziati.
            </div>

            <label>Nome:
                <input type="text" th:field="*{nome}" placeholder="Esempio: Farina">
                <small th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}" style="color:red"></small>
            </label><br>

            <label>Scadenza:
                <input type="date" th:field="*{scadenza}">
                <small th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}" style="color:red"></small>
            </label><br>

            <label>Quantità:
                <input type="number" step="0.1" th:field="*{quantita}">
                <small th:if="${#fields.hasErrors('quantita')}" th:errors="*{quantita}" style="color:red"></small>
            </label><br>

            <label>Unità di Misura:
                <select th:field="*{unitaMisura}">
                    <option th:each="u : ${T(com.generation.foodloop.entities.UnitaMisura).values()}" th:value="${u}" th:text="${u}"></option>
                </select>
            </label><br>

            <label>Posizione:
                <input type="text" th:field="*{posizione}" placeholder="Esempio: Dispensa">
                <small th:if="${#fields.hasErrors('posizione')}" th:errors="*{posizione}" style="color:red"></small>
            </label><br>

            <label>Categoria:
                <select th:field="*{categoria}">
                    <option value="" disabled selected>-- Seleziona categoria --</option>
                    <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}">
                    </option>
                </select>
                <small th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}" style="color:red"></small>
            </label><br>

            <button class="btn" type="submit"
                th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
        </form>

        <hr th:if="${mode == 'create'}">

        <div th:if="${mode == 'create'}" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
            <h3>Non trovi la categoria? Creala ora:</h3>
            <form th:action="@{/categoria}" method="post">
                <label>Nuova Categoria:
                    <input type="text" name="nome" required>
                </label>
                <button class="btn" type="submit">Crea Categoria</button>
            </form>
            <form th:object="${ingredienteDTO}"
            th:action="@{/ingredienti/{id}(id = ${ingredienteDTO.id})}" method="post" th:if="${mode == 'edit'}">

            <div th:if="${#fields.hasErrors('*')}" class="alert alert-error">
                <strong>Attenzione:</strong> Controlla i campi evidenziati.
            </div>

            <label>Nome:
                <input type="text" th:field="*{nome}" placeholder="Esempio: Farina">
                <small th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}" style="color:red"></small>
            </label><br>

            <label>Scadenza:
                <input type="date" th:field="*{scadenza}">
                <small th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}" style="color:red"></small>
            </label><br>

            <label>Quantità:
                <input type="number" step="0.1" th:field="*{quantita}">
                <small th:if="${#fields.hasErrors('quantita')}" th:errors="*{quantita}" style="color:red"></small>
            </label><br>

            <label>Unità di Misura:
                <select th:field="*{unitaMisura}">
                    <option value="" disabled selected>-- Seleziona unita di misura --</option>
                    <option th:each="u : ${unitaMisura}" th:value="${u}" th:text="${u}"></option>
                </select>
            </label><br>

            <label>Posizione:
                <input type="text" th:field="*{posizione}" placeholder="Esempio: Dispensa">
                <small th:if="${#fields.hasErrors('posizione')}" th:errors="*{posizione}" style="color:red"></small>
            </label><br>

            <label>Categoria:
                <select th:field="*{categoria}">
                    <option value="" disabled selected>-- Seleziona categoria --</option>
                    <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}">
                    </option>
                </select>
                <small th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}" style="color:red"></small>
            </label><br>

            <button class="btn" type="submit"
                th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
        </form>

    </div>
</body>

</html>