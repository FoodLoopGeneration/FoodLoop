<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'})}"></head>
<body class="fl-body">
    <header th:replace="~{fragments/layout :: navbar}"></header>

    <div class="main-content-wrapper">
        <div class="form-card-custom">
            <h1 th:text="${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'}"></h1>

            <form th:object="${ingredienteDTO}"
                  th:action="${mode == 'create'} ? @{/ingredienti} : @{/ingredienti/{id}(id=*{id})}"
                  method="post">

                <div th:if="${#fields.hasErrors('*')}" class="alert-custom" style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Attenzione:</strong> Sono presenti errori di validazione.
                </div>

                <div class="field-group">
                    <label>Nome Ingrediente:</label>
                    <input type="text" th:field="*{nome}" placeholder="Esempio: Bastoncini Findus">
                    <small class="error-msg" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}" style="color: red;"></small>
                </div>

                <div class="form-row-custom">
                    <div class="col-half field-group">
                        <label>Scadenza:</label>
                        <input type="date" th:field="*{scadenza}">
                        <small class="error-msg" th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}" style="color: red;"></small>
                    </div>
                    <div class="col-half field-group">
                        <label>Posizione:</label>
                        <input type="text" th:field="*{posizione}" placeholder="Es: Freezer, Dispensa">
                        <small class="error-msg" th:if="${#fields.hasErrors('posizione')}" th:errors="*{posizione}" style="color: red;"></small>
                    </div>
                </div>

                <div class="form-row-custom">
                    <div class="col-half field-group">
                        <label>Quantità:</label>
                        <input type="number" step="0.1" th:field="*{quantita}">
                        <small class="error-msg" th:if="${#fields.hasErrors('quantita')}" th:errors="*{quantita}" style="color: red;"></small>
                    </div>
                    <div class="col-half field-group">
                        <label>Unità di Misura:</label>
                        <select th:field="*{unitaMisura}">
                            <option value="" disabled selected>-- Scegli --</option>
                            <option th:each="u : ${unita}" th:value="${u}" th:text="${u}"></option>
                        </select>
                        <small class="error-msg" th:if="${#fields.hasErrors('unitaMisura')}" th:errors="*{unitaMisura}" style="color: red;"></small>
                    </div>
                </div>

                <div class="field-group">
                    <label>Categoria:</label>
                    <select th:field="*{categoria}">
                        <option value="" disabled selected>-- Seleziona categoria --</option>
                        <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}"></option>
                    </select>
                    <small class="error-msg" th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}" style="color: red;"></small>
                </div>

                <div class="actions-container">
                    <button class="btn-submit-custom" type="submit" 
                            th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
                    <a th:href="@{/ingredienti}" class="btn-cancel-custom">Annulla</a>
                </div>
            </form>

            <div th:if="${mode == 'create'}" class="category-quick-add" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
                <h3 style="color: #2e7d32; font-size: 1.2rem; margin-bottom: 10px;">Manca una categoria? Creala ora:</h3>
                <form th:action="@{/categoria}" th:object="${categoriaDTO}" method="post">
                    <div style="flex: 1;" class="field-group">
                        <input type="text" th:field="*{nome}" required placeholder="Nome nuova categoria">
                    </div>
                    <button class="btn-submit-custom" style="width: auto; margin-top: 10px; padding: 10px 25px;" type="submit">Aggiungi</button>
                </form>
            </div>
        </div>
    </div>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>