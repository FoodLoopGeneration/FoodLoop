<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'})}"></head>
<body class="fl-body">
    <header th:replace="~{fragments/layout :: navbar}"></header>

    <div class="main-content-wrapper">
        <div class="form-card-custom">
            <h1 th:text="${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'}"></h1>

            <form th:object="${ingredienteDTO}"
                  th:action="${mode == 'create'} ? @{/ingredienti} : @{/ingredienti/{id}(id=*{id})}"
                  method="post">

                <div th:if="${#fields.hasErrors('*')}" class="alert-custom">
                    <strong>Attenzione:</strong> Sono presenti errori di validazione.
                </div>

                <div class="field-group">
                    <label>Nome Ingrediente:</label>
                    <input type="text" th:field="*{nome}" placeholder="Esempio: Bastoncini Findus">
                    <small class="error-msg" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></small>
                </div>

                <div class="form-row-custom">
                    <div class="col-half field-group">
                        <label>Scadenza:</label>
                        <input type="date" th:field="*{scadenza}">
                        <small class="error-msg" th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}"></small>
                    </div>
                    <div class="col-half field-group">
                        <label>Quantit√†:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" step="0.1" th:field="*{quantita}" style="flex: 2;">
                            <select th:field="*{unitaMisura}" style="flex: 1; min-width: 90px;">
                                <option th:each="u : ${T(com.generation.foodloop.entities.UnitaMisura).values()}" 
                                        th:value="${u}" th:text="${u}"></option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row-custom">
                    <div class="col-half field-group">
                        <label>Posizione (es. Frigo, Dispensa):</label>
                        <input type="text" th:field="*{posizione}" placeholder="es. Ripiano alto">
                    </div>
                    <div class="col-half field-group">
                        <label>Categoria:</label>
                        <select th:field="*{categoria}">
                            <option value="" disabled selected>-- Seleziona categoria --</option>
                            <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}"></option>
                        </select>
                    </div>
                </div>

                <div class="actions-container">
                    <button class="btn-submit-custom" type="submit" 
                            th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
                    <a th:href="@{/ingredienti}" class="btn-cancel-custom">Annulla</a>
                </div>
            </form>

            <div th:if="${mode == 'create'}" class="category-quick-add">
                <h3 style="color: #2e7d32; font-size: 1.2rem; margin-bottom: 10px;">Manca una categoria? Creala ora:</h3>
                <form th:action="@{/categoria}" th:object="${categoriaDTO}" method="post" >
                    <div style="flex: 1;" class="field-group">
                        <input type="text" th:field="*{nome}" required placeholder="Nome nuova categoria">
                    </div>
                    <button class="btn-submit-custom" style="width: auto; margin-top: 0; padding: 10px 25px;" type="submit">Aggiungi</button>
                </form>
            </div>
        </div>
    </div>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
