<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'})}"></head>
<body class="fl-body">
    <header th:replace="~{fragments/layout :: navbar}"></header>

    <div class="fl-container">
        <h1 class="fl-title" th:text="${mode == 'create' ? 'Nuovo Ingrediente' : 'Modifica Ingrediente'}"></h1>
        <hr class="fl-divider">

        <form th:if="${mode == 'edit'}"
              th:object="${ingredienteDTO}"
              th:action="@{/ingredienti/{id}(id=*{id})}" 
              method="post" class="fl-form-card">

            <div th:if="${#fields.hasErrors('*')}" class="fl-alert-error">
                <strong>Attenzione:</strong> Sono presenti errori di validazione.
            </div>

            <div class="fl-form-group">
                <label class="fl-label">Nome:</label>
                <input type="text" th:field="*{nome}" class="fl-input" placeholder="Esempio: Farina">
                <small class="fl-error-text" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></small>
            </div>

            <div class="form-row">
                <div class="col-6">
                    <label class="label">Scadenza:</label>
                    <input type="date" th:field="*{scadenza}" class="fl-input">
                    <small class="error-text" th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}"></small>
                </div>
                <div class="col-3">
                    <label class="label">Quantità:</label>
                    <input type="number" step="0.1" th:field="*{quantita}" class="fl-input">
                    <small class="error-text" th:if="${#fields.hasErrors('quantita')}" th:errors="*{quantita}"></small>
                </div>
                <div class="col-3">
                    <label class="label">Unità di Misura:</label>
                    <select th:field="*{unitaMisura}" class="select">
                        <option value="" selected>-- Scegli --</option>
                        <option th:each="u : ${T(com.generation.foodloop.entities.UnitaMisura).values()}" th:value="${u}" th:text="${u}"></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="label">Posizione:</label>
                <input type="text" th:field="*{posizione}" class="input" placeholder="Esempio: Dispensa">
                <small class="error-text" th:if="${#fields.hasErrors('posizione')}" th:errors="*{posizione}"></small>
            </div>

            <div class="form-group">
                <label class="label">Categoria:</label>
                <div class="input-group">
                    <select th:field="*{categoria}" class="select">
                        <option value="" disabled selected>-- Seleziona categoria --</option>
                        <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}"></option>
                    </select>
                    <small class="error-text-block" th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}"></small>
                </div>
            </div>

            <div class="action-group">
                <button class="btn-primary" type="submit" th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
                <a th:href="@{/ingredienti}" class="btn-secondary">Annulla</a>
            </div>
        </form>

        <form th:if="${mode == 'create'}"
              th:object="${ingredienteDTO}"
              th:action="@{/ingredienti}" 
              method="post" class="form-card">

            <div th:if="${#fields.hasErrors('*')}" class="alert-error">
                <strong>Attenzione:</strong> Sono presenti errori di validazione.
            </div>

            <div class="form-group">
                <label class="label">Nome:</label>
                <input type="text" th:field="*{nome}" class="input" placeholder="Esempio: Farina">
                <small class="error-text" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></small>
            </div>

            <div class="form-row">
                <div class="col-6">
                    <label class="label">Scadenza:</label>
                    <input type="date" th:field="*{scadenza}" class="input">
                    <small class="ferror-text" th:if="${#fields.hasErrors('scadenza')}" th:errors="*{scadenza}"></small>
                </div>
                <div class="col-3">
                    <label class="label">Quantità:</label>
                    <input type="number" step="0.1" th:field="*{quantita}" class="input">
                    <small class="error-text" th:if="${#fields.hasErrors('quantita')}" th:errors="*{quantita}"></small>
                </div>
                <div class="col-3">
                    <label class="label">Unità di Misura:</label>
                    <select th:field="*{unitaMisura}" class="select">
                        <option value="" selected>-- Scegli --</option>
                        <option th:each="u : ${T(com.generation.foodloop.entities.UnitaMisura).values()}" th:value="${u}" th:text="${u}"></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="label">Posizione:</label>
                <input type="text" th:field="*{posizione}" class="input" placeholder="Esempio: Dispensa">
                <small class="error-text" th:if="${#fields.hasErrors('posizione')}" th:errors="*{posizione}"></small>
            </div>

            <div class="form-group">
                <label class="label">Categoria:</label>
                <div class="input-group">
                    <select th:field="*{categoria}" class="select">
                        <option value="" disabled selected>-- Seleziona categoria --</option>
                        <option th:each="c : ${categorie}" th:value="${c.id}" th:text="${c.nome}"></option>
                    </select>
                    <small class="error-text-block" th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}"></small>
                </div>
            </div>

            <div class="action-group">
                <button class="btn-primary" type="submit" th:text="${mode == 'create' ? 'Crea Ingrediente' : 'Salva Modifiche'}"></button>
                <a th:href="@{/ingredienti}" class="btn-secondary">Annulla</a>
            </div>
        </form>

        <div th:if="${mode == 'create'}" class="category-quick-add">
            <h3 class="subtitle">Manca una categoria? Creala ora:</h3>
            <form th:action="@{/categoria}" th:object="${categoriaDTO}" method="post" class="inline-form">
                <div class="inline-input">
                    <input type="text" th:field="*{nome}" class="input" required placeholder="Nome categoria">
                </div>
                <div class="inline-btn">
                    <button class="btn-outline-success" type="submit">Aggiungi Categoria</button>
                </div>
            </form>
            <p class="muted-text">La nuova categoria sarà associata al tuo profilo.</p>
        </div>
    </div>
    
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
